prometheus:
  prometheusSpec:
    # additionalAlertRelabelConfigs:
    # - source_labels: [__meta_kubernetes_service_label_cluster]
    #   separator: ;
    #   regex: (.*)
    #   target_label: cluster
    #   replacement: $1
    #   action: replace
    # - source_labels: [__meta_kubernetes_service_label_foundation]
    #   separator: ;
    #   regex: (.*)
    #   target_label: foundation
    #   replacement: $1
    #   action: replace
    additionalScrapeConfigs:
    - job_name: "kubeEtcd-${CLUSTER_NAME}"
      file_sd_configs:
      - files:
        - '/prometheus/bosh_target_groups.json'
      scheme: https
      tls_config:
        ca_file: "/etc/prometheus/secrets/etcd-client/etcd-client-ca.crt"
        cert_file: "/etc/prometheus/secrets/etcd-client/etcd-client.crt"
        key_file:  "/etc/prometheus/secrets/etcd-client/etcd-client.key"
        server_name: "*.etcd.cfcr.internal"
      relabel_configs:
      - source_labels: [__meta_bosh_job_process_name]
        regex: etcd
        action: keep
      - source_labels: [__meta_bosh_deployment]
        regex: ${SERVICE_INSTANCE_ID}
        action: keep
      - source_labels: [__address__]
        regex:  '(.*)'
        target_label: __address__
        replacement: '${1}:2379'
